<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moon Songs</title>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: #1a202c;
            color: #f0f2f5;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        h1 {
            margin-top: 40px;
            margin-bottom: 30px;
            font-size: 2.5em;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }
        .song-list {
            display: flex;
            flex-wrap: wrap;
            gap: 32px;
            justify-content: center;
            width: 100%;
            max-width: 1200px;
        }
        .song-card {
            background: rgba(26,32,44,0.85);
            border-radius: 12px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.2);
            padding: 0;
            width: 420px;
            height: 236px;
            display: block;
            position: relative;
            overflow: hidden;
            transition: transform 0.15s, box-shadow 0.15s, background 0.15s;
            text-decoration: none;
            color: inherit;
            cursor: pointer;
            outline: none;
        }
        .song-card:hover, .song-card:focus {
            transform: translateY(-4px) scale(1.03);
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            background: rgba(26,32,44,1);
            text-decoration: none;
        }
        .song-card:active {
            background: #2d3748;
        }
        .song-title {
            margin: 0;
            padding: 0;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            pointer-events: none;
            font-size: 1.5em;
            font-weight: bold;
            color: #fff;
            text-shadow: 0 2px 8px #000, 0 0 2px #000;
        }
        .song-preview {
            width: 100%;
            height: 236px;
            border-radius: 8px;
            margin-bottom: 12px;
            background: #2d3748;
            object-fit: cover;
        }
        @media (max-width: 600px) {
            .song-card {
                width: 95vw;
                height: 160px;
            }
            .song-preview {
                height: 160px;
            }
        }
        .song-link {
            display: inline-block;
            margin-top: 8px;
            padding: 8px 18px;
            background: #f6e05e;
            color: #1a202c;
            border-radius: 6px;
            font-weight: 600;
            text-decoration: none;
            transition: background 0.15s;
        }
        .song-link:hover {
            background: #ffe066;
        }
    </style>
</head>
<body>
    <h1>ムーン</h1>
    <div class="song-list" id="song-list"></div>
    <script>
        // Fetch song folders from PHP endpoint and parse as JSON
        function fetchSongFolders() {
            return fetch('list-folders.js')
                .then(res => {
                    if (!res.ok) throw new Error('Failed to load folder list');
                    return res.json();
                })
                .then(folders => {
                    console.log(folders);
                    return folders;
                });
        }
        const songListDiv = document.getElementById('song-list');
        function generateVideoPreview(folder, img) {
            // Create hidden video and canvas for extracting the first frame
            const video = document.createElement('video');
            video.src = `${folder}/${folder}.mp4`;
            video.crossOrigin = 'anonymous';
            video.muted = true;
            video.playsInline = true;
            video.preload = 'auto';
            video.style.display = 'none';
            const canvas = document.createElement('canvas');
            canvas.width = 280;
            canvas.height = 158;
            canvas.style.display = 'none';
            document.body.appendChild(video);
            document.body.appendChild(canvas);

            video.addEventListener('loadeddata', function onLoadedData() {
                // Seek to a small time to avoid black frame
                video.currentTime = 0.1;
            }, { once: true });
            video.addEventListener('seeked', function onSeeked() {
                const ctx = canvas.getContext('2d');
                ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
                img.src = canvas.toDataURL('image/jpeg', 0.85);
                // Clean up
                document.body.removeChild(video);
                document.body.removeChild(canvas);
            }, { once: true });
            video.load();
        }

        fetchSongFolders().then(songFolders => {
            songFolders.forEach(folder => {
                const link = document.createElement('a');
                link.className = 'song-card';
                link.href = `${folder}/index.html`;
                link.setAttribute('tabindex', '0');
                link.setAttribute('aria-label', folder.replace(/-/g, ' '));

                // Video preview (not playing, no controls)
                const video = document.createElement('video');
                video.className = 'song-preview';
                video.src = `${folder}/${folder}.mp4`;
                video.muted = true;
                video.playsInline = true;
                video.preload = 'metadata';
                video.setAttribute('tabindex', '-1');
                video.setAttribute('aria-label', folder.replace(/-/g, ' '));
                video.controls = false;
                video.setAttribute('controls', '');
                video.controls = false;
                link.appendChild(video);

                // Title overlay
                const title = document.createElement('div');
                title.className = 'song-title';
                title.textContent = folder.replace(/-/g, ' ');
                link.appendChild(title);

                songListDiv.appendChild(link);
            });
        });
    </script>
</body>
</html>
